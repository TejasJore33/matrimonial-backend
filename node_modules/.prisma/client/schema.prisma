generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserRole {
  SELF_MEMBER
  PARENT
  ADMIN
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum MaritalStatus {
  NEVER_MARRIED
  DIVORCED
  WIDOWED
  AWAITING_DIVORCE
}

enum Diet {
  VEGETARIAN
  NON_VEGETARIAN
  EGGETARIAN
  VEGAN
  JAIN
}

enum FamilyType {
  NUCLEAR
  JOINT
  EXTENDED
}

enum ProfileStatus {
  DRAFT
  PENDING_APPROVAL
  ACTIVE
  SUSPENDED
  REJECTED
}

enum InterestStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum SubscriptionPlan {
  FREE
  PREMIUM
  PARENT
  GOLD_3M
  GOLD_PLUS_3M
  DIAMOND_6M
  DIAMOND_PLUS_6M
  PLATINUM_PLUS_12M
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum AddOnType {
  PROFILE_BOOST
  VERIFIED_BADGE
  HOROSCOPE_REPORT
}

enum ServiceType {
  // Profile Enhancement
  PREMIUM_PHOTO_EDITING
  VIDEO_PROFILE_CREATION
  PROFILE_WRITING_SERVICE
  BIODATA_DESIGN

  // Matchmaking & Consultation
  PERSONAL_MATCHMAKER
  RELATIONSHIP_COUNSELING
  FAMILY_CONSULTATION
  COMPATIBILITY_ANALYSIS

  // Verification Services
  BACKGROUND_VERIFICATION
  INCOME_VERIFICATION
  FAMILY_VERIFICATION
  PHOTO_VERIFICATION

  // Communication Services
  VOICE_CALL_CREDITS
  VIDEO_CALL_CREDITS
  MESSAGE_TRANSLATION
  CALL_ASSISTANCE

  // Event Services
  VIRTUAL_SPEED_DATING
  COMMUNITY_MEETUP
  WEDDING_PLANNING
  VENUE_RECOMMENDATIONS

  // Astrology Services
  DETAILED_HOROSCOPE_MATCHING
  KUNDALI_GENERATION
  MUHURAT_SELECTION
  ASTROLOGY_CONSULTATION

  // Premium Search
  ADVANCED_SEARCH_FILTERS
  REVERSE_SEARCH
  PROFILE_ANALYTICS
  MATCH_PREDICTIONS

  // Safety Services
  ID_VERIFICATION
  SAFE_MEETING_ASSISTANCE
  EMERGENCY_SUPPORT
  PRIVACY_PROTECTION

  // Gift & Premium
  GIFT_SUBSCRIPTION
  PROFILE_HIGHLIGHTING
  FEATURED_PROFILE
  PRIORITY_LISTING

  // Post-Match Services
  PRE_WEDDING_PHOTOGRAPHY
  WEDDING_VENDOR_RECOMMENDATIONS
  LEGAL_DOCUMENTATION_HELP
  POST_MARRIAGE_SUPPORT

  // Specialized Services
  NRI_MATCHMAKING
  SECOND_MARRIAGE_SUPPORT
  REGIONAL_LANGUAGE_SUPPORT
}

enum ServiceStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  REFUNDED
}

model User {
  id               String    @id @default(cuid())
  email            String?   @unique
  mobile           String?   @unique
  password         String?
  role             UserRole  @default(SELF_MEMBER)
  isEmailVerified  Boolean   @default(false)
  isMobileVerified Boolean   @default(false)
  googleId         String?   @unique
  appleId          String?   @unique
  fcmToken         String? // Firebase Cloud Messaging token for push notifications
  referralCode     String?   @unique // For referral program
  referredBy       String? // User ID who referred this user
  points           Int       @default(0) // Gamification points
  lastActiveAt     DateTime? // Last active timestamp
  isOnline         Boolean   @default(false) // Online status
  lastLoginDate    DateTime? // For daily login rewards
  loginStreak      Int       @default(0) // Consecutive login days
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  lastLoginAt      DateTime?
  gdprConsent      Boolean   @default(false)
  gdprConsentAt    DateTime?
  deletedAt        DateTime?

  profile                 Profile?
  interests               Interest[]         @relation("SentInterests")
  receivedInterests       Interest[]         @relation("ReceivedInterests")
  chats                   Chat[]             @relation("User1")
  chats2                  Chat[]             @relation("User2")
  messages                Message[]
  subscriptions           Subscription[]
  payments                Payment[]
  profileViews            ProfileView[]      @relation("Viewer")
  sessions                Session[]
  notifications           Notification[]
  shortlists              Shortlist[]
  blockedUsers            BlockedUser[]      @relation("Blocker")
  blockedBy               BlockedUser[]      @relation("Blocked")
  referrals               Referral[]         @relation("Referrer")
  referredByRef           Referral[]         @relation("Referred")
  referrer                User?              @relation("Referrer", fields: [referredBy], references: [id])
  referredUsers           User[]             @relation("Referrer")
  achievements            Achievement[]
  horoscopes              Horoscope[]
  familyMembers           FamilyMember[]
  successStories          SuccessStory[]
  documents               Document[]
  videoCallsAsCaller      VideoCall[]        @relation("VideoCallCaller")
  videoCallsAsParticipant VideoCall[]        @relation("VideoCallParticipant")
  forumPosts              ForumPost[]
  forumComments           ForumComment[]
  groupMembers            GroupMember[]
  eventParticipants       EventParticipant[]
  blogPosts               BlogPost[]
  preferredLanguage       String?            @default("en")
  notificationPreferences Json? // Store notification preferences as JSON
  matchScores             MatchScore[]       @relation("UserMatches")
  matchedBy               MatchScore[]       @relation("MatchedUser")
  searchHistory           SearchHistory[]
  messageTemplates        MessageTemplate[]
  iceBreakers             IceBreaker[]
  activities              Activity[]
  leaderboard             Leaderboard[]
  wishlists               Wishlist[]
  profileExports          ProfileExport[]
  services                Service[]
  serviceBookings         ServiceBooking[]

  @@index([email])
  @@index([mobile])
  @@index([referralCode])
  @@map("users")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  ipAddress String?
  userAgent String?
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("sessions")
}

model Profile {
  id     String        @id @default(cuid())
  userId String        @unique
  status ProfileStatus @default(DRAFT)

  // Basic Info
  firstName     String?
  lastName      String?
  gender        Gender?
  dateOfBirth   DateTime?
  height        Int? // in cm
  maritalStatus MaritalStatus?

  // Religion & Culture
  religion     String?
  caste        String?
  motherTongue String?
  manglik      Boolean?
  gothra       String?

  // Location
  country     String?
  state       String?
  city        String?
  citizenship String?

  // Education & Career
  education      String?
  college        String?
  occupation     String?
  income         Int? // annual in INR
  incomeCurrency String? @default("INR")

  // Family
  fatherOccupation String?
  motherOccupation String?
  siblings         Int?
  familyType       FamilyType?

  // Lifestyle
  diet     Diet?
  smoking  Boolean?
  drinking Boolean?
  hobbies  String? // JSON array

  // Partner Preferences (JSON)
  partnerPreferences Json?

  // Media
  photos        Photo[]
  videoIntroUrl String?
  biodataUrl    String? // PDF/Word document URL

  // Enhanced Profile Features
  aboutMe    String? // Rich text "About Me" story
  highlights Json? // Array of highlighted features/achievements
  latitude   Float? // For distance calculation
  longitude  Float? // For distance calculation

  // Privacy Settings (JSON)
  privacySettings     Json?
  isHiddenFromSearch  Boolean @default(false) // Hide from search results
  isAnonymousViewing  Boolean @default(false) // Anonymous browsing mode
  contactPrivacyLevel String? @default("AFTER_MATCH") // NEVER, AFTER_MATCH, PREMIUM_ONLY
  photoPrivacyLevel   String? @default("AFTER_MATCH") // PUBLIC, AFTER_MATCH, LOCKED

  // Verification
  isVerified        Boolean   @default(false)
  verifiedAt        DateTime?
  trustScore        Int       @default(0)
  completenessScore Int       @default(0) // Profile completeness percentage
  isHighlighted     Boolean   @default(false) // Premium highlighting

  // SEO
  slug String? @unique

  // Relations
  profileViews  ProfileView[]
  shortlistedBy Shortlist[]
  horoscope     Horoscope?
  comparisons   ProfileComparison[]
  testimonials  Testimonial[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([gender])
  @@index([religion])
  @@index([city])
  @@index([slug])
  @@index([isHiddenFromSearch])
  @@map("profiles")
}

model Photo {
  id           String   @id @default(cuid())
  profileId    String
  url          String
  cloudinaryId String?
  isPrimary    Boolean  @default(false)
  isBlurred    Boolean  @default(true)
  isApproved   Boolean  @default(false)
  order        Int      @default(0)
  albumName    String?  @default("Default") // Photo album organization
  caption      String? // Photo caption
  createdAt    DateTime @default(now())
  profile      Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([albumName])
  @@map("photos")
}

model Verification {
  id         String    @id @default(cuid())
  userId     String    @unique
  idType     String // Aadhar, Passport, etc.
  idNumber   String?
  idPhotoUrl String?
  selfieUrl  String?
  status     String    @default("PENDING") // PENDING, APPROVED, REJECTED
  reviewedBy String?
  reviewedAt DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([userId])
  @@map("verifications")
}

model Interest {
  id         String         @id @default(cuid())
  fromUserId String
  toUserId   String
  status     InterestStatus @default(PENDING)
  message    String?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  fromUser   User           @relation("SentInterests", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser     User           @relation("ReceivedInterests", fields: [toUserId], references: [id], onDelete: Cascade)

  @@unique([fromUserId, toUserId])
  @@index([fromUserId])
  @@index([toUserId])
  @@index([status])
  @@map("interests")
}

model Chat {
  id            String    @id @default(cuid())
  user1Id       String
  user2Id       String
  lastMessageAt DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  user1         User      @relation("User1", fields: [user1Id], references: [id], onDelete: Cascade)
  user2         User      @relation("User2", fields: [user2Id], references: [id], onDelete: Cascade)
  messages      Message[]

  @@unique([user1Id, user2Id])
  @@index([user1Id])
  @@index([user2Id])
  @@map("chats")
}

model Message {
  id          String   @id @default(cuid())
  chatId      String
  senderId    String
  content     String?
  imageUrl    String?
  videoUrl    String? // For video messages
  audioUrl    String? // For voice messages
  fileUrl     String? // For file attachments
  fileName    String? // Original file name
  messageType String   @default("TEXT") // TEXT, IMAGE, VIDEO, AUDIO, FILE
  isRead      Boolean  @default(false)
  isDeleted   Boolean  @default(false) // Deleted for everyone
  deletedBy   String[] @default([]) // Array of user IDs who deleted this message (delete for me)
  isReported  Boolean  @default(false)
  createdAt   DateTime @default(now())
  chat        Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  sender      User     @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([chatId])
  @@index([senderId])
  @@index([createdAt])
  @@map("messages")
}

model ProfileView {
  id         String   @id @default(cuid())
  profileId  String
  viewedById String
  createdAt  DateTime @default(now())
  profile    Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  viewedBy   User     @relation("Viewer", fields: [viewedById], references: [id], onDelete: Cascade)

  @@unique([profileId, viewedById])
  @@index([profileId])
  @@index([viewedById])
  @@map("profile_views")
}

model ContactView {
  id             String       @id @default(cuid())
  subscriptionId String
  profileId      String
  viewedById     String
  createdAt      DateTime     @default(now())
  subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@unique([subscriptionId, profileId, viewedById])
  @@index([subscriptionId])
  @@index([profileId])
  @@index([viewedById])
  @@map("contact_views")
}

model Subscription {
  id                       String           @id @default(cuid())
  userId                   String
  plan                     SubscriptionPlan
  razorpaySubscriptionId   String?
  razorpayPlanId           String?
  status                   String           @default("ACTIVE") // ACTIVE, CANCELLED, EXPIRED
  startDate                DateTime
  endDate                  DateTime
  // Plan feature tracking
  contactViewsUsed         Int              @default(0) // Number of contact numbers viewed
  contactViewsLimit        Int? // Max contact views allowed (null = unlimited)
  profileBoostCredits      Int              @default(0) // Profile boost credits included
  verifiedBadgeIncluded    Boolean          @default(false) // Verified badge included in plan
  horoscopeReportsIncluded Int              @default(0) // Horoscope reports included
  createdAt                DateTime         @default(now())
  updatedAt                DateTime         @updatedAt
  user                     User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  contactViews             ContactView[]

  @@index([userId])
  @@index([status])
  @@map("subscriptions")
}

model Payment {
  id                String        @id @default(cuid())
  userId            String
  razorpayOrderId   String?       @unique
  razorpayPaymentId String?       @unique
  amount            Int // in paise
  currency          String        @default("INR")
  status            PaymentStatus @default(PENDING)
  type              String // SUBSCRIPTION, ADDON
  addOnType         AddOnType?
  subscriptionId    String?
  metadata          Json?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  addOns            AddOn[]
  services          Service[]

  @@index([userId])
  @@index([status])
  @@index([razorpayOrderId])
  @@map("payments")
}

model AddOn {
  id        String    @id @default(cuid())
  userId    String
  type      AddOnType
  paymentId String?
  expiresAt DateTime?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  payment   Payment?  @relation(fields: [paymentId], references: [id])

  @@index([userId])
  @@index([type])
  @@map("add_ons")
}

model Service {
  id          String           @id @default(cuid())
  userId      String
  type        ServiceType
  status      ServiceStatus    @default(PENDING)
  paymentId   String?
  amount      Int // in paise
  metadata    Json? // Service-specific data
  scheduledAt DateTime? // For consultations, events, etc.
  completedAt DateTime?
  notes       String? // Admin/service provider notes
  rating      Int? // 1-5 rating after completion
  review      String? // User review
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  payment     Payment?         @relation(fields: [paymentId], references: [id])
  bookings    ServiceBooking[]

  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([paymentId])
  @@map("services")
}

model ServiceProvider {
  id            String           @id @default(cuid())
  name          String
  email         String           @unique
  mobile        String           @unique
  serviceType   ServiceType
  expertise     String? // Description of expertise
  rating        Float            @default(0)
  totalBookings Int              @default(0)
  isActive      Boolean          @default(true)
  metadata      Json? // Additional provider info
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  bookings      ServiceBooking[]

  @@index([serviceType])
  @@index([isActive])
  @@map("service_providers")
}

model ServiceBooking {
  id          String           @id @default(cuid())
  serviceId   String
  providerId  String?
  userId      String
  scheduledAt DateTime?
  duration    Int? // Duration in minutes
  status      ServiceStatus    @default(PENDING)
  meetingLink String? // For virtual consultations/events
  notes       String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  service     Service          @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  provider    ServiceProvider? @relation(fields: [providerId], references: [id])
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@index([userId])
  @@index([providerId])
  @@index([status])
  @@map("service_bookings")
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String // INTEREST, MESSAGE, MATCH, VIEW, etc.
  title     String
  message   String
  isRead    Boolean  @default(false)
  metadata  Json?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@map("notifications")
}

model SavedSearch {
  id        String   @id @default(cuid())
  userId    String
  name      String
  filters   Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@map("saved_searches")
}

model OTP {
  id         String   @id @default(cuid())
  identifier String // email or mobile
  code       String
  type       String // EMAIL, MOBILE
  expiresAt  DateTime
  isUsed     Boolean  @default(false)
  createdAt  DateTime @default(now())

  @@index([identifier, code])
  @@index([expiresAt])
  @@map("otps")
}

model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("MODERATOR") // ADMIN, MODERATOR
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

model Report {
  id             String    @id @default(cuid())
  reporterId     String
  reportedUserId String
  type           String // PROFILE, MESSAGE, PHOTO
  reason         String
  description    String?
  status         String    @default("PENDING") // PENDING, REVIEWED, RESOLVED
  reviewedBy     String?
  reviewedAt     DateTime?
  createdAt      DateTime  @default(now())

  @@index([reporterId])
  @@index([reportedUserId])
  @@index([status])
  @@map("reports")
}

// Shortlist/Favorites
model Shortlist {
  id         String   @id @default(cuid())
  userId     String
  profileId  String
  folderName String?  @default("Default") // Organize into folders
  notes      String? // User notes about this profile
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  profile    Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([userId, profileId])
  @@index([userId])
  @@index([profileId])
  @@map("shortlists")
}

// Block/Unblock Users
model BlockedUser {
  id        String   @id @default(cuid())
  blockerId String
  blockedId String
  reason    String?
  createdAt DateTime @default(now())
  blocker   User     @relation("Blocker", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked   User     @relation("Blocked", fields: [blockedId], references: [id], onDelete: Cascade)

  @@unique([blockerId, blockedId])
  @@index([blockerId])
  @@index([blockedId])
  @@map("blocked_users")
}

// Horoscope Matching
model Horoscope {
  id            String           @id @default(cuid())
  userId        String           @unique
  profileId     String           @unique
  horoscopeUrl  String? // PDF/image URL
  birthTime     String? // Birth time (HH:MM)
  birthPlace    String? // Birth place
  rashi         String? // Moon sign
  nakshatra     String? // Birth star
  mangalDosha   Boolean?         @default(false)
  horoscopeData Json? // Full horoscope data (JSON)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  user          User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  profile       Profile          @relation(fields: [profileId], references: [id], onDelete: Cascade)
  matches1      HoroscopeMatch[] @relation("Horoscope1")
  matches2      HoroscopeMatch[] @relation("Horoscope2")

  @@index([userId])
  @@index([rashi])
  @@index([nakshatra])
  @@map("horoscopes")
}

// Horoscope Matching Results
model HoroscopeMatch {
  id               String    @id @default(cuid())
  user1Id          String
  user2Id          String
  horoscope1Id     String
  horoscope2Id     String
  ashtakootScore   Int? // Out of 36
  mangalDoshaMatch Boolean?  @default(false)
  overallScore     Int? // Overall compatibility (0-100)
  matchDetails     Json? // Detailed matching results
  createdAt        DateTime  @default(now())
  horoscope1       Horoscope @relation("Horoscope1", fields: [horoscope1Id], references: [id], onDelete: Cascade)
  horoscope2       Horoscope @relation("Horoscope2", fields: [horoscope2Id], references: [id], onDelete: Cascade)

  @@unique([user1Id, user2Id])
  @@index([user1Id])
  @@index([user2Id])
  @@map("horoscope_matches")
}

// Success Stories
model SuccessStory {
  id          String    @id @default(cuid())
  userId      String
  partnerId   String
  title       String
  story       String // Full story text
  weddingDate DateTime?
  photos      Json? // Array of photo URLs
  isApproved  Boolean   @default(false)
  isFeatured  Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isApproved])
  @@index([isFeatured])
  @@map("success_stories")
}

// Family Member Management
model FamilyMember {
  id               String   @id @default(cuid())
  userId           String // Main user ID
  name             String
  relation         String // FATHER, MOTHER, SIBLING, etc.
  email            String?  @unique
  mobile           String?  @unique
  password         String?
  canViewMatches   Boolean  @default(true)
  canSendInterests Boolean  @default(true)
  canChat          Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("family_members")
}

// Referral Program
model Referral {
  id           String    @id @default(cuid())
  referrerId   String
  referredId   String
  rewardAmount Int?      @default(0) // Reward in points or amount
  status       String    @default("PENDING") // PENDING, COMPLETED, PAID
  completedAt  DateTime?
  createdAt    DateTime  @default(now())
  referrer     User      @relation("Referrer", fields: [referrerId], references: [id], onDelete: Cascade)
  referred     User      @relation("Referred", fields: [referredId], references: [id], onDelete: Cascade)

  @@unique([referrerId, referredId])
  @@index([referrerId])
  @@index([referredId])
  @@map("referrals")
}

// Gamification - Achievements
model Achievement {
  id          String   @id @default(cuid())
  userId      String
  type        String // PROFILE_COMPLETE, FIRST_INTEREST, FIRST_MATCH, etc.
  title       String
  description String?
  points      Int      @default(0)
  icon        String? // Icon URL or name
  unlockedAt  DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@map("achievements")
}

// Document Management
model Document {
  id         String    @id @default(cuid())
  userId     String
  type       String // AADHAR, PASSPORT, PAN, DEGREE, etc.
  name       String
  url        String
  expiryDate DateTime?
  isVerified Boolean   @default(false)
  verifiedAt DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([isVerified])
  @@map("documents")
}

// Video Call Sessions
model VideoCall {
  id            String    @id @default(cuid())
  callerId      String
  participantId String
  status        String    @default("SCHEDULED") // SCHEDULED, PENDING, IN_PROGRESS, COMPLETED, CANCELLED
  scheduledAt   DateTime?
  startedAt     DateTime?
  endedAt       DateTime?
  cancelledAt   DateTime?
  duration      Int? // Duration in minutes
  roomId        String? // WebRTC room ID
  notes         String?
  caller        User      @relation("VideoCallCaller", fields: [callerId], references: [id], onDelete: Cascade)
  participant   User      @relation("VideoCallParticipant", fields: [participantId], references: [id], onDelete: Cascade)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([callerId])
  @@index([participantId])
  @@index([status])
  @@map("video_calls")
}

// Profile Comparison
model ProfileComparison {
  id             String    @id @default(cuid())
  userId         String
  profileId      String
  comparisonData Json? // Comparison details
  createdAt      DateTime  @default(now())
  expiresAt      DateTime? // Comparison expires after X days
  profile        Profile   @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([userId, profileId])
  @@index([userId])
  @@index([profileId])
  @@map("profile_comparisons")
}

// Community - Forum Posts
model ForumPost {
  id        String         @id @default(cuid())
  userId    String
  title     String
  content   String
  category  String?
  tags      String[]
  likes     Int            @default(0)
  views     Int            @default(0)
  isPinned  Boolean        @default(false)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  comments  ForumComment[]

  @@index([userId])
  @@index([category])
  @@index([createdAt])
  @@map("forum_posts")
}

model ForumComment {
  id        String    @id @default(cuid())
  userId    String
  postId    String
  content   String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  post      ForumPost @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([postId])
  @@map("forum_comments")
}

// Community - Groups
model CommunityGroup {
  id          String        @id @default(cuid())
  name        String
  description String
  photoUrl    String?
  isPublic    Boolean       @default(true)
  createdBy   String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  members     GroupMember[]

  @@index([createdBy])
  @@index([isPublic])
  @@map("community_groups")
}

model GroupMember {
  id       String         @id @default(cuid())
  groupId  String
  userId   String
  role     String         @default("MEMBER") // MEMBER, ADMIN, MODERATOR
  joinedAt DateTime       @default(now())
  group    CommunityGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user     User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
  @@map("group_members")
}

// Community - Events
model CommunityEvent {
  id              String             @id @default(cuid())
  title           String
  description     String
  eventDate       DateTime
  location        String
  photoUrl        String?
  maxParticipants Int?
  createdBy       String
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  participants    EventParticipant[]

  @@index([eventDate])
  @@index([createdBy])
  @@map("community_events")
}

model EventParticipant {
  id       String         @id @default(cuid())
  eventId  String
  userId   String
  joinedAt DateTime       @default(now())
  event    CommunityEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user     User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
  @@map("event_participants")
}

// Community - Blog
model BlogPost {
  id          String   @id @default(cuid())
  userId      String
  title       String
  content     String
  excerpt     String?
  photoUrl    String?
  tags        String[]
  isPublished Boolean  @default(false)
  views       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isPublished])
  @@index([createdAt])
  @@map("blog_posts")
}

// Match Score & Compatibility
model MatchScore {
  id             String   @id @default(cuid())
  userId         String
  matchedUserId  String
  overallScore   Int // 0-100 compatibility score
  religionScore  Int?
  educationScore Int?
  lifestyleScore Int?
  locationScore  Int?
  familyScore    Int?
  matchReasons   Json? // Array of reasons why they match
  isReverseMatch Boolean  @default(false) // If matched user also matches this user's preferences
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation("UserMatches", fields: [userId], references: [id], onDelete: Cascade)
  matchedUser    User     @relation("MatchedUser", fields: [matchedUserId], references: [id], onDelete: Cascade)

  @@unique([userId, matchedUserId])
  @@index([userId])
  @@index([matchedUserId])
  @@index([overallScore])
  @@map("match_scores")
}

// Search History
model SearchHistory {
  id          String   @id @default(cuid())
  userId      String
  profileId   String? // If searched for specific profile
  searchQuery String? // Search text
  filters     Json? // Applied filters
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("search_history")
}

// Message Templates
model MessageTemplate {
  id        String   @id @default(cuid())
  userId    String
  name      String
  content   String
  category  String? // GREETING, FOLLOW_UP, etc.
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("message_templates")
}

// Ice Breakers
model IceBreaker {
  id        String   @id @default(cuid())
  userId    String
  profileId String
  question  String
  answer    String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, profileId])
  @@map("ice_breakers")
}

// Testimonials
model Testimonial {
  id             String   @id @default(cuid())
  profileId      String
  authorName     String
  authorRelation String? // FRIEND, FAMILY, COLLEAGUE
  authorEmail    String?
  content        String
  rating         Int? // 1-5 stars
  isApproved     Boolean  @default(false)
  createdAt      DateTime @default(now())
  profile        Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([isApproved])
  @@map("testimonials")
}

// Activity Feed
model Activity {
  id          String   @id @default(cuid())
  userId      String
  type        String // PROFILE_UPDATE, PHOTO_ADDED, INTEREST_SENT, etc.
  title       String
  description String?
  metadata    Json?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@map("activities")
}

// Leaderboard
model Leaderboard {
  id          String    @id @default(cuid())
  userId      String
  category    String // MOST_ACTIVE, MOST_VIEWED, TOP_MATCHES
  rank        Int
  score       Int
  period      String // DAILY, WEEKLY, MONTHLY, ALL_TIME
  periodStart DateTime
  periodEnd   DateTime?
  createdAt   DateTime  @default(now())
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category, period, periodStart])
  @@index([category, period, rank])
  @@map("leaderboard")
}

// Wishlist/Preferences Tracker
model Wishlist {
  id        String   @id @default(cuid())
  userId    String
  criteria  Json // Ideal partner criteria
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("wishlists")
}

// Profile Export History
model ProfileExport {
  id        String   @id @default(cuid())
  userId    String
  format    String // PDF, JSON
  url       String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("profile_exports")
}
